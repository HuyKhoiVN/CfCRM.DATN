@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = null;
}
@using CoffeeCRM.Data.Constants
<style>
    .bg-light-primary {
        background-color: rgba(0, 123, 255, 0.1) !important;
    }

    .bg-light-success {
        background-color: rgba(40, 167, 69, 0.1) !important;
    }

    .bg-light-warning {
        background-color: rgba(255, 193, 7, 0.1) !important;
    }

    .notification-item {
        transition: all 0.3s ease;
    }

        .notification-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }

    #kt_menu_notifications {
        animation: fadeIn 0.3s ease-in-out;
    }

    /* Badge positioning */
    .position-relative .badge {
        transform: translate(-50%, -50%) !important;
    }

    /* Scrollbar styling */
    .scroll-y::-webkit-scrollbar {
        width: 5px;
    }

    .scroll-y::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .scroll-y::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
    }

        .scroll-y::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    #tableNotification_info,
    #tableNotification_length,
    #tableNotification thead tr th,
    #tableNotification_wrapper div:nth-child(2) {
        display: none;
    }

    .no-wrap {
        white-space: nowrap;
        min-width: 0;
    }

    .flex-wrap {
        display: flex;
        flex-wrap: wrap;
    }

    .notification-item {
        transition: background-color 0.3s ease;
    }

        .notification-item:hover {
            background-color: #ededeb;
        }

    .table-title {
        font-size: 20px;
        font-weight: bold;
    }

    /*   .dish-name {
            color: #007bff;
        } */

    .quantity {
        color: red;
        font-weight: bold;
    }
</style>
<div id="kt_app_header" class="app-header ">

    <!--begin::Header container-->
    <div class="app-container  container-fluid d-flex align-items-stretch justify-content-between " id="kt_app_header_container">

        <!--begin::Sidebar mobile toggle-->
        <div class="d-flex align-items-center d-lg-none ms-n3 me-1 me-md-2" title="Show sidebar menu">
            <div class="btn btn-icon btn-active-color-primary w-35px h-35px" id="kt_app_sidebar_mobile_toggle">
                <i class="ki-duotone ki-abstract-14 fs-2 fs-md-1"><span class="path1"></span><span class="path2"></span></i>
            </div>
        </div>
        <!--end::Sidebar mobile toggle-->
        <!--begin::Mobile logo-->
        <div class="d-flex align-items-center flex-grow-1 flex-lg-grow-0">
            <a href="index.html" class="d-lg-none">
                <img alt="Logo" src="/suri/coffee-logo-small.png" class="h-30px" />
            </a>
        </div>
        <!--end::Mobile logo-->
        <!--begin::Header wrapper-->
        <div class="d-flex align-items-stretch justify-content-end flex-lg-grow-1" id="kt_app_header_wrapper">

            <!--begin::Navbar-->
            <div class="app-navbar flex-shrink-0">
                <!--begin::Activities-->
                @* <div class="app-navbar-item ms-1 ms-md-3">
                <!--begin::Drawer toggle-->
                <div class="btn btn-icon btn-custom btn-icon-muted btn-active-light btn-active-color-primary w-30px h-30px w-md-40px h-md-40px" id="kt_activities_toggle">
                <i class="ki-duotone ki-notification-on fs-2 fs-lg-1"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span></i>
                </div>
                <!--end::Drawer toggle-->
                </div> *@
                <!--end::Activities-->
                <!--begin::Notifications-->
                <div class="app-navbar-item ms-1 ms-md-3">
                    <!-- Notification Bell Icon with Badge -->
                    <div class="position-relative btn btn-icon btn-custom btn-icon-muted btn-active-light btn-active-color-primary w-40px h-40px rounded-circle shadow-sm" data-kt-menu-trigger="{default: 'click'}" data-kt-menu-attach="parent" data-kt-menu-placement="bottom-end" id="kt_menu_item_wow">
                        <i class="ki-duotone ki-notification-on fs-1 text-primary">
                            <span class="path1"></span>
                            <span class="path2"></span>
                            <span class="path3"></span>
                            <span class="path4"></span>
                            <span class="path5"></span>
                        </i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                            <span id="notification-count">5</span>
                            <span class="visually-hidden">unread notifications</span>
                        </span>
                    </div>

                    <!-- Notification Dropdown Menu -->
                    <div class="menu menu-sub menu-sub-dropdown menu-column w-350px w-lg-450px shadow-lg rounded-3 border-0" data-kt-menu="true" id="kt_menu_notifications">
                        <!-- Header with Title and Mark All as Read -->
                        <div class="card-header bg-light py-3 d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 fw-bold text-dark"><i class="ki-duotone ki-notification-status fs-4 me-2 text-primary"></i>Thông báo</h5>
                            <button class="btn btn-sm btn-outline-primary rounded-pill px-3 d-none" id="markAllAsRead">
                                <i class="ki-duotone ki-shield-tick fs-5 me-1">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                </i>
                                Đánh dấu tất cả là đã đọc
                            </button>
                        </div>

                        <!-- Notification Content Area -->
                        <div class="tab-content">
                            <div class="scroll-y overflow-auto" style="max-height: 65vh; min-height: 200px;" id="notifications">
                                <!-- Notifications will be loaded here by JavaScript -->
                            </div>
                        </div>

                        <!-- View More Button -->
                        <div class="card-footer bg-light py-2 text-center">
                            <a class="d-none justify-content-center cursor-pointer text-primary fw-semibold" onclick="viewMore()" id="viewMoreBtn">
                                <span>Xem thêm</span>
                                <i class="ki-duotone ki-arrow-down fs-5 ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <script>
                    let pageIndex = 1;
                    let pageSize = 7;

                    async function loadDataSelectNoti() {
                        await $.ajax({
                            url: systemURL + `dishorder/api/ListQueue?pageIndex=${pageIndex}&pageSize=${pageSize}`,
                            type: 'GET',
                            async: 'true',
                            beforeSend: function (xhr) {
                                if (localStorage.token) {
                                    xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
                                }
                            },
                            contentType: 'application/json',
                            success: function (responseData) {
                                var data = responseData.data;
                                var htmlNoti = "";

                                if (@RoleConst.BARTENDER == profile.roleId) {
                                    data.forEach(function (item) {
                                        let detail = "";
                                        item.dishOrderDetails.forEach(function (orderItem) {
                                            detail += `
                                                <div class="row mb-1">
                                                    <div class="col-7">
                                                        <span class="text-dark fw-semibold">${orderItem.dishName}</span>
                                                    </div>
                                                    <div class="col-5 text-end">
                                                        <span class="badge bg-light-primary text-primary fw-bold">${orderItem.quantity}</span>
                                                    </div>
                                                </div>
                                            `;
                                        });

                                        htmlNoti += `
                                            <div class="notification-item card mb-3 border-0 shadow-sm">
                                                <div class="card-header bg-light-primary py-2">
                                                    <h5 class="card-title mb-0 text-primary fw-bold">
                                                        <i class="ki-duotone ki-table fs-4 me-2">
                                                            <span class="path1"></span>
                                                            <span class="path2"></span>
                                                        </i>
                                                        ${item.tableName}
                                                    </h5>
                                                </div>
                                                <div class="card-body p-3">
                                                    <div class="row mb-2">
                                                        <div class="col-7">
                                                            <h6 class="text-muted fw-bold">Tên món</h6>
                                                        </div>
                                                        <div class="col-5 text-end">
                                                            <h6 class="text-muted fw-bold">Số lượng</h6>
                                                        </div>
                                                    </div>
                                                    ${detail}
                                                    <div class="text-center mt-3">
                                                        <button type="button" class="btn btn-primary btn-sm rounded-pill px-4 py-2"
                                                            data-fromuserid="${item.accountId}"
                                                            data-dishOrderId="${item.id}"
                                                            data-tableId="${item.tableId}"
                                                            onclick="doneDishOrder(this)">
                                                            <i class="ki-duotone ki-check fs-5 me-1"></i>
                                                            Hoàn thành
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    });
                                } else {
                                    data.forEach(function (item) {
                                        // Determine background color based on notification status
                                        const bgClass = item.notificationStatusId === 1 ? 'bg-light-success' : 'bg-light-warning';
                                        const borderClass = item.notificationStatusId === 1 ? 'border-success' : 'border-warning';
                                        const statusText = item.notificationStatusId === 1 ? 'Đã đọc' : 'Chưa đọc';
                                        const statusBadge = item.notificationStatusId === 1 ? 'bg-success' : 'bg-warning';
                                        const btnCompleteClass = item.notificationStatusId === 1 ? 'd-none' : '';

                                        htmlNoti += `
                                            <div class="notification-item card mb-3 border-start border-4 ${borderClass} shadow-sm">
                                                <div class="card-body p-3 ${bgClass}">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h5 class="mb-0 fw-bold text-dark">${item.name}</h5>
                                                        <span class="badge ${statusBadge} text-white">${statusText}</span>
                                                    </div>
                                                    <p class="mb-2 text-muted">${item.content || 'Không có nội dung'}</p>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <small class="text-muted">
                                                            <i class="ki-duotone ki-calendar fs-6 me-1"></i>
                                                            ${timeAgo(moment(item.createdTime).format("DD/MM/YYYY HH:mm:ss"))}
                                                        </small>
                                                        <button class="btn btn-sm btn-primary rounded-pill ${btnCompleteClass}"
                                                            onclick="readNotification('${item.id}')">
                                                            <i class="ki-duotone ki-check fs-6 me-1"></i>
                                                            Hoàn thành
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    });

                                    $("#viewMoreBtn").removeClass('d-none').addClass('d-flex');
                                }

                                if (pageIndex == 1) {
                                    $("#notifications").html(htmlNoti || '<div class="text-center p-5"><i class="ki-duotone ki-notification-bing fs-1 text-muted mb-3"></i><p>Không có thông báo nào</p></div>');
                                } else {
                                    $("#notifications").append(htmlNoti);
                                }

                                // Update notification count
                                $("#notification-count").text(data.filter(item => item.notificationStatusId === 2).length);
                            },
                            error: function (e) {
                                if (pageIndex == 1) {
                                    $("#notifications").html('<div class="text-center p-5"><i class="ki-duotone ki-notification-bing fs-1 text-muted mb-3"></i><p>Thông báo trống!</p></div>');
                                }
                                $("#viewMoreBtn").removeClass('d-flex').addClass('d-none');
                            }
                        });
                    }

                    $(document).ready(function () {
                        loadDataSelectNoti();

                        // Mark all as read button
                        $("#markAllAsRead").on("click", function() {
                            // Add your logic to mark all notifications as read
                            Swal.fire({
                                title: 'Xác nhận',
                                text: "Đánh dấu tất cả thông báo là đã đọc?",
                                icon: 'question',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Xác nhận',
                                cancelButtonText: 'Huỷ'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    // Add your API call here
                                    loadDataSelectNoti();
                                }
                            });
                        });
                    });

                    function doneDishOrder(element) {
                        var dishOrderId = element.getAttribute('data-dishorderid');
                        var tableId = element.getAttribute('data-tableid');
                        var fromUserId = element.getAttribute('data-fromuserid');

                        Swal.fire({
                            title: 'Hoàn thành',
                            text: "Xác nhận thay đổi?",
                            icon: 'info',
                            showCancelButton: true,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#443',
                            confirmButtonText: 'Xác nhận',
                            cancelButtonText: 'Huỷ'
                        }).then((result) => {
                            if (result.value) {
                                let UpdateObj = {
                                    "id": dishOrderId,
                                    "tableId": tableId,
                                    "accountId": fromUserId,
                                    "dishOrderStatusId": @DishOrderStatudConst.DONE
                                };

                                $.ajax({
                                    url: systemURL + "dishorder/api/Update",
                                    type: "POST",
                                    contentType: "application/json",
                                    beforeSend: function (xhr) {
                                        if (localStorage.token) {
                                            xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
                                        }
                                    },
                                    data: JSON.stringify(UpdateObj),
                                    success: function (responseData) {
                                        if (responseData.status == "200" && responseData.message === "SUCCESS") {
                                            Swal.fire(
                                                'Thành công!',
                                                'Đã hoàn thành món',
                                                'success'
                                            );
                                            loadDataSelectNoti();
                                        }
                                    },
                                    error: function (e) {
                                        Swal.fire(
                                            'Lỗi!',
                                            'Đã xảy ra lỗi, vui lòng thử lại',
                                            'error'
                                        );
                                    }
                                });
                            }
                        });
                    }

                    function readNotification(id) {
                        // Call the API to mark notification as read
                        $.ajax({
                            url: systemURL + "notification/api/read-notifi/" + id,
                            type: "GET",
                            beforeSend: function (xhr) {
                                if (localStorage.token) {
                                    xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
                                }
                            },
                            success: function (responseData) {
                                // Reload notifications after marking as read
                                loadDataSelectNoti();

                                Swal.fire({
                                    title: 'Thành công!',
                                    text: 'Đã đánh dấu thông báo là đã đọc',
                                    icon: 'success',
                                    timer: 1500,
                                    showConfirmButton: false
                                });
                            },
                            error: function (e) {
                                Swal.fire(
                                    'Lỗi!',
                                    'Đã xảy ra lỗi, vui lòng thử lại',
                                    'error'
                                );
                            }
                        });
                    }

                    function viewMore() {
                        pageIndex++;
                        loadDataSelectNoti();
                    }
                </script>
                <!--end::Notifications-->
                <!--begin::Theme mode-->
                <div class="app-navbar-item ms-1 ms-md-3">

                    <!--begin::Menu toggle-->
                    <a href="#" class="btn btn-icon btn-custom btn-icon-muted btn-active-light btn-active-color-primary w-30px h-30px w-md-40px h-md-40px" data-kt-menu-trigger="{default:'click', lg: 'hover'}" data-kt-menu-attach="parent" data-kt-menu-placement="bottom-end">
                        <i class="ki-duotone ki-night-day theme-light-show fs-2 fs-lg-1"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span><span class="path10"></span></i>    <i class="ki-duotone ki-moon theme-dark-show fs-2 fs-lg-1"><span class="path1"></span><span class="path2"></span></i>
                    </a>
                    <!--begin::Menu toggle-->
                    <!--begin::Menu-->
                    <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-title-gray-700 menu-icon-gray-500 menu-active-bg menu-state-color fw-semibold py-4 fs-base w-150px" data-kt-menu="true" data-kt-element="theme-mode-menu">
                        <!--begin::Menu item-->
                        <div class="menu-item px-3 my-0">
                            <a href="#" class="menu-link px-3 py-2" data-kt-element="mode" data-kt-value="light">
                                <span class="menu-icon" data-kt-element="icon">
                                    <i class="ki-duotone ki-night-day fs-2"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span><span class="path10"></span></i>
                                </span>
                                <span class="menu-title">
                                    Sáng
                                </span>
                            </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3 my-0">
                            <a href="#" class="menu-link px-3 py-2" data-kt-element="mode" data-kt-value="dark">
                                <span class="menu-icon" data-kt-element="icon">
                                    <i class="ki-duotone ki-moon fs-2"><span class="path1"></span><span class="path2"></span></i>
                                </span>
                                <span class="menu-title">
                                    Tối
                                </span>
                            </a>
                        </div>
                        <!--end::Menu item-->
                    </div>
                    <!--end::Menu-->

                </div>
                <!--end::Theme mode-->
                <!--begin::User menu-->
                <div class="app-navbar-item ms-1 ms-md-3" id="kt_header_user_menu_toggle">
                    <!--begin::Menu wrapper-->
                    <div class="cursor-pointer symbol symbol-30px symbol-md-40px"
                         data-kt-menu-trigger="{default: 'click', lg: 'hover'}"
                         data-kt-menu-attach="parent"
                         data-kt-menu-placement="bottom-end">
                        <img class="ac-photo" src="/images/userdefault.jpg" alt="user" />
                    </div>

                    <!--begin::User account menu-->
                    <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg menu-state-color fw-semibold py-4 fs-6 w-275px" data-kt-menu="true">
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                            <div class="menu-content d-flex align-items-center px-3">
                                <!--begin::Avatar-->
                                <div class="symbol symbol-50px me-5">
                                    <img alt="Logo" class="ac-photo" src="/images/userdefault.jpg" />
                                </div>
                                <!--end::Avatar-->
                                <!--begin::Username-->
                                <div class="d-flex flex-column">
                                    <div class="fw-bold d-flex align-items-center fs-5 flex-wrap">
                                        <span class="ac-full-name ms-2 no-wrap"></span>
                                        <span class="badge badge-light-success fw-bold fs-8 px-2 py-1 ac-type"></span>
                                    </div>
                                    <a href="#" class="fw-semibold text-muted text-hover-primary fs-7 ac-email">
                                    </a>
                                </div>
                                <!--end::Username-->
                            </div>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu separator-->
                        <div class="separator my-2"></div>
                        <!--end::Menu separator-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-5">
                            <a href="/account/admin/info-profile" class="menu-link px-5">
                                Thông tin cá nhân
                            </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        @* <div class="menu-item px-5">
                        <a href="apps/projects/list.html" class="menu-link px-5">
                        <span class="menu-text">Dự án của tôi</span>
                        <span class="menu-badge">
                        <span class="badge badge-light-danger badge-circle fw-bold fs-7">3</span>
                        </span>
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-5" data-kt-menu-trigger="{default: 'click', lg: 'hover'}" data-kt-menu-placement="left-start" data-kt-menu-offset="-15px, 0">
                        <a href="#" class="menu-link px-5">
                        <span class="menu-title">Cấu hình cá nhân</span>
                        <span class="menu-arrow"></span>
                        </a>

                        <!--begin::Menu sub-->
                        <div class="menu-sub menu-sub-dropdown w-175px py-4">
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/referrals.html" class="menu-link px-5">
                        Giới thiệu
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/billing.html" class="menu-link px-5">
                        Đơn hàng
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/statements.html" class="menu-link px-5">
                        Thanh toán
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/statements.html" class="menu-link d-flex flex-stack px-5">
                        Báo cáo

                        <span class="ms-2 lh-0" data-bs-toggle="tooltip" title="Xem báo cáo">
                        <i class="ki-duotone ki-information-5 fs-5"><span class="path1"></span><span class="path2"></span><span class="path3"></span></i>
                        </span>
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu separator-->
                        <div class="separator my-2"></div>
                        <!--end::Menu separator-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <div class="menu-content px-3">
                        <label class="form-check form-switch form-check-custom form-check-solid">
                        <input class="form-check-input w-30px h-20px" type="checkbox" value="1" checked="checked" name="notifications" />
                        <span class="form-check-label text-muted fs-7">
                        Thông báo
                        </span>
                        </label>
                        </div>
                        </div>
                        <!--end::Menu item-->
                        </div>
                        <!--end::Menu sub-->
                        </div>*@
                        <!--end::Menu item-->
                        <!--begin::Menu separator-->
                        <div class="separator my-2"></div>
                        <!--end::Menu separator-->
                        @*                         <!--begin::Menu item-->
                        <div class="menu-item px-5" data-kt-menu-trigger="{default: 'click', lg: 'hover'}" data-kt-menu-placement="left-start" data-kt-menu-offset="-15px, 0">
                        <a href="#" class="menu-link px-5">
                        <span class="menu-title position-relative">
                        Language

                        <span class="fs-8 rounded bg-light px-3 py-2 position-absolute translate-middle-y top-50 end-0">
                        English <img class="w-15px h-15px rounded-1 ms-2" src="/admin/assets/media/flags/united-states.svg" alt="" />
                        </span>
                        </span>
                        </a>

                        <!--begin::Menu sub-->
                        <div class="menu-sub menu-sub-dropdown w-175px py-4">
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/settings.html" class="menu-link d-flex px-5 active">
                        <span class="symbol symbol-20px me-4">
                        <img class="rounded-1" src="/admin/assets/media/flags/united-states.svg" alt="" />
                        </span>
                        English
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/settings.html" class="menu-link d-flex px-5">
                        <span class="symbol symbol-20px me-4">
                        <img class="rounded-1" src="/admin/assets/media/flags/spain.svg" alt="" />
                        </span>
                        Spanish
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/settings.html" class="menu-link d-flex px-5">
                        <span class="symbol symbol-20px me-4">
                        <img class="rounded-1" src="/admin/assets/media/flags/germany.svg" alt="" />
                        </span>
                        German
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/settings.html" class="menu-link d-flex px-5">
                        <span class="symbol symbol-20px me-4">
                        <img class="rounded-1" src="/admin/assets/media/flags/japan.svg" alt="" />
                        </span>
                        Japanese
                        </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                        <a href="account/settings.html" class="menu-link d-flex px-5">
                        <span class="symbol symbol-20px me-4">
                        <img class="rounded-1" src="/admin/assets/media/flags/france.svg" alt="" />
                        </span>
                        French
                        </a>
                        </div>
                        <!--end::Menu item-->
                        </div>
                        <!--end::Menu sub-->
                        </div>
                        <!--end::Menu item--> *@
                        <!--begin::Menu item-->
                        @*<div class="menu-item px-5 my-1">
                        <a href="account/settings.html" class="menu-link px-5">
                        Cài đặt tài khoản
                        </a>
                        </div>*@
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-5">
                            <a href="javascript:void(Logout())" class="menu-link px-5">
                                Đăng xuất
                            </a>
                        </div>
                        <!--end::Menu item-->
                    </div>
                    <!--end::User account menu-->
                    <!--end::Menu wrapper-->
                </div>
                <!--end::User menu-->
                <!--begin::Header menu toggle-->
                <div class="app-navbar-item d-lg-none ms-2 me-n2" title="Show header menu">
                    <div class="btn btn-flex btn-icon btn-active-color-primary w-30px h-30px" id="kt_app_header_menu_toggle">
                        <i class="ki-duotone ki-element-4 fs-1"><span class="path1"></span><span class="path2"></span></i>
                    </div>
                </div>
                <!--end::Header menu toggle-->
            </div>
            <!--end::Navbar-->
        </div>
        <!--end::Header wrapper-->
    </div>
    <!--end::Header container-->
</div>
<script>
    var tableNotification;
    // $(document).ready(function () {
    //     $('#list-notification').html('');
    //     initTableNotification();
    // })
    // function initTableNotification() {
    //     $.ajax({
    //         url: systemURL + "notification/api/load-notifi-icon",
    //         type: "GET",
    //         contentType: "application/json",
    //         beforeSend: function (xhr) {
    //             if (localStorage.token) {
    //                 xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
    //             }
    //         },
    //         success: function (responseData) {
    //             if (responseData.message == "SUCCESS" && responseData.status == "200") {
    //                 let listDataNotifi = responseData.data;
    //                 if (listDataNotifi.length > 0) {
    //                     listDataNotifi.forEach(row => {
    //                         let viewApprove = row.approveTime != null ? "" : "d-none";
    //                         let swapViewApprove = row.approveTime == null ? "" : "d-none";
    //                         let photo = row.photo ?? "/images/userdefault.jpg";
    //                         let notiItem = `  <div  onclick="readNotificationAjax(${row.id}); window.open('${systemURL}${row.url}');" style="cursor: pointer;">
    //                                <div id="list-notifi" class="notification-item" style="cursor: pointer; border-bottom: 1px solid black; padding: 10px  "  >
    //                                                    <div class="d-flex flex-column gap-2 col-md-12  ">
    //                                                        <div class="d-flex gap-1 align-items-center">
    //                                                            <h5 style="width: 320px; ">${row.name}</h5>`
    //                             + (row.notificationStatusId == @@NotificationStatusId.Unread ? `<span class="badge badge-circle badge-primary h-10px w-10px text-start animation-blink ms-5"></span>` : "") +
    //                             `</div>
    //                                                    <div class="d-flex justify-content-between" >
    //                                                            <div class="d-flex flex-row gap-2">
    //                                                                <img class="rounded-circle" width="45" height="45" src="${photo}" />
    //                                                                <div class="d-flex flex-column gap-1">
    //                                                                    <div style="font-size:14px"> Người tạo</div>
    //                                                                        <div style="font-size:14px"><b>${row.userCreate}</b></div>
    //                                                                </div>
    //                                                            </div>
    //                                                            <div class="d-flex flex-column gap-1 ${swapViewApprove}">
    //                                                                <div style="font-size:14px"> Ngày gửi </div>
    //                                                                    <div style="font-size:14px"> <b>${moment(row.createdTime).format("DD/MM/YYYY HH:mm")}</b></div>
    //                                                            </div>
    //                                                        </div>
    //                                                        <div class="d-flex justify-content-between ${viewApprove}">
    //                                                            <div class="d-flex flex-column gap-1">
    //                                                                <div style="font-size:13px">Ngày duyệt</div>
    //                                                                <div style="font-size:13px"><b>${moment(row.approveTime).format("DD/MM/YYYY HH:mm")}</b></div>
    //                                                            </div>
    //                                                            <div class="d-flex flex-column gap-1">
    //                                                                <div style="font-size:13px"> Ngày gửi </div>
    //                                                                <div style="font-size:13px"> <b>${moment(row.createdTime).format("DD/MM/YYYY HH:mm")}</b></div>
    //                                                            </div>
    //                                                        </div>
    //                                                        <a class="mt-2 link-primary cursor-pointer" href="/${row.url}" target="_blank" onclick="readNotificationAjax(${row.id})"> Xem chi tiết </a>
    //                                                   </div>
    //                                              </div>
    //                                              </div>`;
    //                         document.getElementById("list-notification").innerHTML += notiItem;
    //                     });
    //                 }
    //             }
    //         },
    //         error: function () {

    //         }

    //     });
    // }

    function readNotificationAjax(id) {
        $.ajax({
            url: systemURL + "notification/api/read-notifi/" + id,
            type: "GET",
            contentType: "application/json",
            success: function (responseData) {
                if (responseData.status == 200 && responseData.message === "SUCCESS") {
                    reGenTableNotification();
                }
            },
            error: function (e) {
                console.log("Thay đổi trạng thái thông báo thất bại");
            }
        });

    }

</script>


<script>
    async function Logout() {
        try {
            var result = await httpService.postAsync("account/api/logout");
            if (result.status == "200") {
                localStorage.removeItem("token");
                localStorage.removeItem("profile");
                Swal.fire("Đăng xuất", "Đăng xuất tài khoản thành công.", "success").then(function () {
                    location.href = "/admin/action/sign-in";
                });
            }
        }
        catch (error) {
            Swal.fire("Cảnh báo", "Bạn chưa đăng nhập!<br> Vui lòng đăng nhập để sử dụng hệ thống.", "warning").then(function () {
                location.href = "/admin/action/sign-in";
            });
        }
    }
    $(document).ready(function () {
        var profile = localStorage.profile;
        if (profile) {
            profile = JSON.parse(profile);
            $(".ac-full-name").text(profile.fullName != null ? profile.fullName : 'Người dùng');
            //$(".ac-email").text(profile.email != null ? profile.email : 'Chưa có email');
            $(".ac-type").text(profile.roleName != null ? profile.roleName : '');
            $(".ac-type").attr("style", "background-color:" + customBagdeColor(profile.roleColor) + "; color: " + profile.roleColor + "")
            $(".ac-photo").attr('src', profile.photo != null ? systemURL + profile.photo : systemURL + '/images/userdefault.jpg');
        }
    });
</script>